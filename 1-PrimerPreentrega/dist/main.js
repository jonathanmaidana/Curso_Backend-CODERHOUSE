(()=>{"use strict";var t={31:function(t,e,i){var o=this&&this.__awaiter||function(t,e,i,o){return new(i||(i=Promise))((function(n,r){function s(t){try{l(o.next(t))}catch(t){r(t)}}function d(t){try{l(o.throw(t))}catch(t){r(t)}}function l(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(s,d)}l((o=o.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0});const n=i(147),r=Date.now();e.default=class{constructor(t){this.text=t}getAll(){return o(this,void 0,void 0,(function*(){try{const t=yield n.promises.readFile(this.text,"utf-8"),e=yield JSON.parse(t);if(e.length)return e;console.log("No hay productos")}catch(t){console.log(t)}}))}getById(t){return o(this,void 0,void 0,(function*(){try{const e=yield n.promises.readFile(this.text,"utf8");return(yield JSON.parse(e)).find((e=>e.id===t))||console.log("No se encontro el producto")}catch(t){console.log(t)}}))}updateById(t){return o(this,void 0,void 0,(function*(){console.log(t);try{const e=yield n.promises.readFile(this.text,"utf8");let i=yield JSON.parse(e);const o=i.findIndex((e=>e.id===t.id));return-1!==o?(i[o]=t,yield n.promises.writeFile(this.text,JSON.stringify(i,null,2)),{msg:`El producto con el id ${t.id} fue actualizado`}):{error:"El producto no existe"}}catch(t){console.log(t)}}))}newObj(t){return o(this,void 0,void 0,(function*(){try{const e=yield n.promises.readFile(this.text,"utf8"),i=JSON.parse(e);return i.length?yield n.promises.writeFile(this.text,JSON.stringify([...i,Object.assign(Object.assign({},t),{timestamp:r,id:i.length+1})],null,2)):yield n.promises.writeFile(this.text,JSON.stringify([Object.assign(Object.assign({},t),{timestamp:r,id:i.length+1})],null,2)),i.length+1}catch(t){console.log(t)}}))}deleteById(t){return o(this,void 0,void 0,(function*(){try{const e=yield n.promises.readFile(this.text,"utf8"),i=JSON.parse(e),o=i.find((e=>e.id===t));if(o){const e=i.filter((e=>e.id!==t));return yield n.promises.writeFile(this.text,JSON.stringify(e,null,2),"utf8"),{msg:`El producto con el id ${o.id} se elimino`}}return{err:"Producto no encontrado"}}catch(t){console.log(t)}}))}deleteAll(){return o(this,void 0,void 0,(function*(){try{yield n.promises.writeFile(this.text,JSON.stringify([]),"utf8"),console.log("Productos borrados")}catch(t){console.log(t)}}))}}},184:function(t,e,i){var o=this&&this.__awaiter||function(t,e,i,o){return new(i||(i=Promise))((function(n,r){function s(t){try{l(o.next(t))}catch(t){r(t)}}function d(t){try{l(o.throw(t))}catch(t){r(t)}}function l(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(s,d)}l((o=o.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0});const n=i(147),r=Date.now();e.default=class{constructor(t){this.text=t}getAll(){return o(this,void 0,void 0,(function*(){try{const t=yield n.promises.readFile(this.text,"utf-8"),e=yield JSON.parse(t);if(e.length)return e;console.log("No hay productos")}catch(t){console.log(t)}}))}getById(t){return o(this,void 0,void 0,(function*(){try{const e=yield n.promises.readFile(this.text,"utf8");return(yield JSON.parse(e)).find((e=>e.id===t))||console.log("No se encontro el producto")}catch(t){console.log(t)}}))}updateById(t){return o(this,void 0,void 0,(function*(){console.log(t);try{const e=yield n.promises.readFile(this.text,"utf8");let i=yield JSON.parse(e);const o=i.findIndex((e=>e.id===t.id));return-1!==o?(i[o]=t,yield n.promises.writeFile(this.text,JSON.stringify(i,null,2)),{msg:`El producto con el id ${t.id} fue actualizado`}):{error:"El producto no existe"}}catch(t){console.log(t)}}))}newObj(t){return o(this,void 0,void 0,(function*(){try{const e=yield n.promises.readFile(this.text,"utf8"),i=JSON.parse(e);return i.length?yield n.promises.writeFile(this.text,JSON.stringify([...i,Object.assign(Object.assign({},t),{timestamp:r,id:i.length+1})],null,2)):yield n.promises.writeFile(this.text,JSON.stringify([Object.assign(Object.assign({},t),{timestamp:r,id:i.length+1})],null,2)),i.length+1}catch(t){console.log(t)}}))}deleteById(t){return o(this,void 0,void 0,(function*(){try{const e=yield n.promises.readFile(this.text,"utf8"),i=JSON.parse(e),o=i.find((e=>e.id===t));if(o){const e=i.filter((e=>e.id!==t));return yield n.promises.writeFile(this.text,JSON.stringify(e,null,2),"utf8"),{msg:`El producto con el id ${o.id} se elimino`}}return{err:"Producto no encontrado"}}catch(t){console.log(t)}}))}}},728:function(t,e,i){var o=this&&this.__awaiter||function(t,e,i,o){return new(i||(i=Promise))((function(n,r){function s(t){try{l(o.next(t))}catch(t){r(t)}}function d(t){try{l(o.throw(t))}catch(t){r(t)}}function l(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(s,d)}l((o=o.apply(t,e||[])).next())}))},n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(860),s=n(i(184)),d=n(i(31)),{Router:l}=r,c=new s.default("./prod.txt"),u=(new d.default("./carrito.txt"),r()),a=l(),f=l(),p=Date.now();u.use(r.urlencoded({extended:!0})),u.use(r.static("public")),u.set("view engine","ejs"),u.set("views","./public"),a.get("/",((t,e)=>o(void 0,void 0,void 0,(function*(){const t=yield c.getAll();e.render("productos",{root:__dirname,listaProductos:t})})))),a.get("/:id",((t,e)=>o(void 0,void 0,void 0,(function*(){const{id:i}=t.params,o=yield c.getById(Number(i));e.send(o)})))),a.post("/",((t,e)=>o(void 0,void 0,void 0,(function*(){const i=t.query;console.log(t);const o=yield c.newObj(i);e.json({msg:"Producto agregado",saveObj:o,object:i,timestamp:p})})))),a.put("/:id",((t,e)=>o(void 0,void 0,void 0,(function*(){const{id:i}=t.params,o=t.query,n=yield c.updateById(Object.assign({id:Number(i)},o));e.json({update:n})})))),a.delete("/:id",((t,e)=>o(void 0,void 0,void 0,(function*(){const{id:i}=t.params,o=yield c.deleteById(Number(i));e.json(o)})))),u.use("/api/productos",a),u.use("/api/carrito",f),u.listen(8080,(()=>{console.log("Server running on port 8080")}))},860:t=>{t.exports=require("express")},147:t=>{t.exports=require("fs")}},e={};!function i(o){var n=e[o];if(void 0!==n)return n.exports;var r=e[o]={exports:{}};return t[o].call(r.exports,r,r.exports,i),r.exports}(728)})();