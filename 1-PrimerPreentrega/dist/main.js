(()=>{"use strict";var e={184:function(e,t,i){var o=this&&this.__awaiter||function(e,t,i,o){return new(i||(i=Promise))((function(n,r){function s(e){try{c(o.next(e))}catch(e){r(e)}}function d(e){try{c(o.throw(e))}catch(e){r(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(s,d)}c((o=o.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const n=i(147);t.default=class{constructor(e){this.text=e}getAll(){return o(this,void 0,void 0,(function*(){try{const e=yield n.promises.readFile(this.text,"utf-8"),t=yield JSON.parse(e);if(t.length)return t;console.log("No hay productos")}catch(e){console.log(e)}}))}getById(e){return o(this,void 0,void 0,(function*(){try{const t=yield n.promises.readFile(this.text,"utf8");return(yield JSON.parse(t)).find((t=>t.id===e))||console.log("No se encontro el producto")}catch(e){console.log(e)}}))}updateById(e){return o(this,void 0,void 0,(function*(){console.log(e);try{const t=yield n.promises.readFile(this.text,"utf8");let i=yield JSON.parse(t);const o=i.findIndex((t=>t.id===e.id));return-1!==o?(i[o]=e,yield n.promises.writeFile(this.text,JSON.stringify(i,null,2)),{msg:`El producto con el id ${e.id} fue actualizado`}):{error:"El producto no existe"}}catch(e){console.log(e)}}))}newObj(e){return o(this,void 0,void 0,(function*(){try{const t=yield n.promises.readFile(this.text,"utf8"),i=JSON.parse(t);return i.length?yield n.promises.writeFile(this.text,JSON.stringify([...i,Object.assign(Object.assign({},e),{id:i.length+1})],null,2)):yield n.promises.writeFile(this.text,JSON.stringify([Object.assign(Object.assign({},e),{id:i.length+1})],null,2)),i.length+1}catch(e){console.log(e)}}))}deleteById(e){return o(this,void 0,void 0,(function*(){try{const t=yield n.promises.readFile(this.text,"utf8"),i=JSON.parse(t),o=i.find((t=>t.id===e));if(o){const t=i.filter((t=>t.id!==e));return yield n.promises.writeFile(this.text,JSON.stringify(t,null,2),"utf8"),{msg:`El producto con el id ${o.id} se elimino`}}return{err:"Producto no encontrado"}}catch(e){console.log(e)}}))}}},728:function(e,t,i){var o=this&&this.__awaiter||function(e,t,i,o){return new(i||(i=Promise))((function(n,r){function s(e){try{c(o.next(e))}catch(e){r(e)}}function d(e){try{c(o.throw(e))}catch(e){r(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(s,d)}c((o=o.apply(e,t||[])).next())}))},n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=i(860),s=n(i(184)),{Router:d}=r,c=new s.default("./prod.txt"),l=r(),u=d();l.use(r.urlencoded({extended:!0})),l.use(r.static("public")),l.set("view engine","ejs"),l.set("views","./public"),u.get("/",((e,t)=>o(void 0,void 0,void 0,(function*(){const e=yield c.getAll();t.render("productos",{root:__dirname,listaProductos:e})})))),u.get("/:id",((e,t)=>o(void 0,void 0,void 0,(function*(){const{id:i}=e.params,o=yield c.getById(Number(i));t.send(o)})))),u.post("/",((e,t)=>o(void 0,void 0,void 0,(function*(){const i=e.query,o=yield c.newObj(i);t.json({msg:"Producto agregado",saveObj:o,object:i})})))),u.put("/:id",((e,t)=>o(void 0,void 0,void 0,(function*(){const{id:i}=e.params,o=e.query,n=yield c.updateById(Object.assign({id:Number(i)},o));t.json({update:n})})))),u.delete("/:id",((e,t)=>o(void 0,void 0,void 0,(function*(){const{id:i}=e.params;console.log(e.params);const o=yield c.deleteById(Number(i));t.json(o)})))),l.use("/productos",u),l.listen(8080,(()=>{console.log("Server running on port 8080")}))},860:e=>{e.exports=require("express")},147:e=>{e.exports=require("fs")}},t={};!function i(o){var n=t[o];if(void 0!==n)return n.exports;var r=t[o]={exports:{}};return e[o].call(r.exports,r,r.exports,i),r.exports}(728)})();