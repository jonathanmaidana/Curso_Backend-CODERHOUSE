(()=>{"use strict";var t={31:function(t,e,i){var o=this&&this.__awaiter||function(t,e,i,o){return new(i||(i=Promise))((function(n,r){function s(t){try{c(o.next(t))}catch(t){r(t)}}function d(t){try{c(o.throw(t))}catch(t){r(t)}}function c(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(s,d)}c((o=o.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0});const n=i(147),r=Date.now();e.default=class{constructor(t){this.text=t}createCart(t){return o(this,void 0,void 0,(function*(){try{yield n.promises.writeFile("./carrito.txt",JSON.stringify([Object.assign(Object.assign({},t),{timestamp:r,id:1})],null,2))}catch(t){console.log(t)}}))}deleteAll(){return o(this,void 0,void 0,(function*(){try{return yield n.promises.writeFile(this.text,JSON.stringify([]),"utf8"),console.log("Productos borrados"),{msg:"Carrito vacio"}}catch(t){console.log(t)}}))}getAll(){return o(this,void 0,void 0,(function*(){try{const t=yield n.promises.readFile(this.text,"utf-8"),e=yield JSON.parse(t);if(e.length)return e;console.log("No hay productos")}catch(t){console.log(t)}}))}getById(t){return o(this,void 0,void 0,(function*(){console.log(t);try{const e=yield n.promises.readFile("./prod.txt","utf8"),i=(yield JSON.parse(e)).find((e=>e.id===t)),o=yield n.promises.readFile(this.text),r=yield JSON.parse(o);if(console.log(i),!i)return console.log("No se encontro el producto");yield n.promises.writeFile(this.text,JSON.stringify([...r,i],null,2))}catch(t){console.log(t)}}))}updateById(t){return o(this,void 0,void 0,(function*(){console.log(t);try{const e=yield n.promises.readFile("./prod.txt","utf8");let i=yield JSON.parse(e);const o=i.findIndex((e=>e.id===t.id));return-1!==o?(i[o]=t,yield n.promises.writeFile(this.text,JSON.stringify([...i,Object.assign(Object.assign({},t),{timestamp:r,id:i.length+1})],null,2)),{msg:`El producto con el id ${t.id} fue actualizado`}):{error:"El producto no existe"}}catch(t){console.log(t)}}))}deleteById(t){return o(this,void 0,void 0,(function*(){try{const e=yield n.promises.readFile(this.text,"utf8"),i=JSON.parse(e),o=i.find((e=>e.id===t));if(o){const e=i.filter((e=>e.id!==t));return yield n.promises.writeFile(this.text,JSON.stringify(e,null,2),"utf8"),{msg:`El producto con el id ${o.id} se elimino`}}return{err:"Producto no encontrado"}}catch(t){console.log(t)}}))}}},184:function(t,e,i){var o=this&&this.__awaiter||function(t,e,i,o){return new(i||(i=Promise))((function(n,r){function s(t){try{c(o.next(t))}catch(t){r(t)}}function d(t){try{c(o.throw(t))}catch(t){r(t)}}function c(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(s,d)}c((o=o.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0});const n=i(147),r=Date.now();e.default=class{constructor(t){this.text=t}getAll(){return o(this,void 0,void 0,(function*(){try{const t=yield n.promises.readFile(this.text,"utf-8"),e=yield JSON.parse(t);if(e.length)return e;console.log("No hay productos")}catch(t){console.log(t)}}))}getById(t){return o(this,void 0,void 0,(function*(){try{const e=yield n.promises.readFile(this.text,"utf8");return(yield JSON.parse(e)).find((e=>e.id===t))||console.log("No se encontro el producto")}catch(t){console.log(t)}}))}updateById(t){return o(this,void 0,void 0,(function*(){console.log(t);try{const e=yield n.promises.readFile(this.text,"utf8");let i=yield JSON.parse(e);const o=i.findIndex((e=>e.id===t.id));return-1!==o?(i[o]=t,yield n.promises.writeFile(this.text,JSON.stringify(i,null,2)),{msg:`El producto con el id ${t.id} fue actualizado`}):{error:"El producto no existe"}}catch(t){console.log(t)}}))}newObj(t){return o(this,void 0,void 0,(function*(){try{const e=yield n.promises.readFile(this.text,"utf8"),i=JSON.parse(e);return i.length?yield n.promises.writeFile(this.text,JSON.stringify([...i,Object.assign(Object.assign({},t),{timestamp:r,id:i.length+1})],null,2)):yield n.promises.writeFile(this.text,JSON.stringify([Object.assign(Object.assign({},t),{timestamp:r,id:i.length+1})],null,2)),i.length+1}catch(t){console.log(t)}}))}deleteById(t){return o(this,void 0,void 0,(function*(){try{const e=yield n.promises.readFile(this.text,"utf8"),i=JSON.parse(e),o=i.find((e=>e.id===t));if(o){const e=i.filter((e=>e.id!==t));return yield n.promises.writeFile(this.text,JSON.stringify(e,null,2),"utf8"),{msg:`El producto con el id ${o.id} se elimino`}}return{err:"Producto no encontrado"}}catch(t){console.log(t)}}))}}},728:function(t,e,i){var o=this&&this.__awaiter||function(t,e,i,o){return new(i||(i=Promise))((function(n,r){function s(t){try{c(o.next(t))}catch(t){r(t)}}function d(t){try{c(o.throw(t))}catch(t){r(t)}}function c(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(s,d)}c((o=o.apply(t,e||[])).next())}))},n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(860),s=n(i(184)),d=n(i(31)),{Router:c}=r,l=new s.default("./prod.txt"),u=new d.default("./carrito.txt"),a=r(),f=c(),p=c(),y=Date.now();a.use(r.urlencoded({extended:!0})),a.use(r.static("public")),a.set("view engine","ejs"),a.set("views","./public"),f.get("/",((t,e)=>o(void 0,void 0,void 0,(function*(){const t=yield l.getAll();e.render("productos",{root:__dirname,listaProductos:t})})))),f.get("/:id",((t,e)=>o(void 0,void 0,void 0,(function*(){const{id:i}=t.params,o=yield l.getById(Number(i));e.send(o)})))),f.post("/",((t,e)=>o(void 0,void 0,void 0,(function*(){const i=t.query,o=yield l.newObj(i);e.json({msg:"Producto agregado",saveObj:o,object:i,timestamp:y})})))),f.put("/:id",((t,e)=>o(void 0,void 0,void 0,(function*(){const{id:i}=t.params,o=t.query,n=yield l.updateById(Object.assign({id:Number(i)},o));e.json({update:n})})))),f.delete("/:id",((t,e)=>o(void 0,void 0,void 0,(function*(){const{id:i}=t.params,o=yield l.deleteById(Number(i));e.json(o)})))),p.post("/",((t,e)=>o(void 0,void 0,void 0,(function*(){const i=t.query,o=yield u.createCart(i);e.json({msg:"Producto agregado",timestamp:y,id:o,object:i})})))),p.delete("/:id",((t,e)=>o(void 0,void 0,void 0,(function*(){const t=yield u.deleteAll();e.json(t)})))),p.get("/:id/productos",((t,e)=>o(void 0,void 0,void 0,(function*(){const t=yield u.getAll();e.render("carrito",{root:__dirname,listaCarrito:t})})))),p.post("/:id/productos",((t,e)=>o(void 0,void 0,void 0,(function*(){const{id:i}=t.params,o=yield u.getById(Number(i));e.json({msg:"Producto agregado",timestamp:y,id:i,object:o})})))),p.delete("/:id/productos/:id_prod",((t,e)=>o(void 0,void 0,void 0,(function*(){const{id:i}=t.params,o=yield u.deleteById(Number(i));e.json(o)})))),a.use("/api/productos",f),a.use("/api/carrito",p),a.listen(8080,(()=>{console.log("Server running on port 8080")}))},860:t=>{t.exports=require("express")},147:t=>{t.exports=require("fs")}},e={};!function i(o){var n=e[o];if(void 0!==n)return n.exports;var r=e[o]={exports:{}};return t[o].call(r.exports,r,r.exports,i),r.exports}(728)})();